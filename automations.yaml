# -----------------------------------------------------------------------
# -----------------------------------------------------------------------
- id: kitchen_cover_stop
  alias: Konyhai redöny stop
  trigger:
  - platform: state
    entity_id: switch.ro1_l_r2_2
    to: 'on'
    for: "00:00:42"
  - platform: state
    entity_id: switch.ro1_f_r2_4
    to: 'on'
    for: "00:00:42"
  action:
  - service: switch.turn_off
    entity_id: switch.ro1_l_r2_2
  - service: switch.turn_off
    entity_id: switch.ro1_f_r2_4

# -----------------------------------------------------------------------
# -----------------------------------------------------------------------
- id: livingroom_cover_stop
  alias: Nappali redöny stop
  trigger:
  - platform: state
    entity_id: switch.ro2_l_r2_1
    to: 'on'
    for: "00:00:42"
  - platform: state
    entity_id: switch.ro2_f_r2_3
    to: 'on'
    for: "00:00:42"
  action:
  - service: switch.turn_off
    entity_id: switch.ro2_l_r2_1
  - service: switch.turn_off
    entity_id: switch.ro2_f_r2_3

# -----------------------------------------------------------------------
# - A M B I E N T   L I G H T S
# -----------------------------------------------------------------------
- id: automatic_ambient_lights_on
  alias: Automatic ambient lights
  trigger:
  - platform: state
    entity_id: sun.sun
    to: 'below_horizon'
  - platform: template
    value_template: '{{ states.sensor.lightlevel_7.state | int < states.input_number.ambient_on_below_lux.state | int }}'
  - platform: state
    entity_id: input_number.livingroom_ambient_brightness
  - platform: state
    entity_id: input_number.stair_ambient_brightness
  - platform: state
    entity_id: input_number.ambient_off_above_lux
  - platform: state
    entity_id: input_number.ambient_on_below_lux
  action:
  - service: script.turn_on
    entity_id: script.ambient_lights_on
      
- id: automatic_ambient_lights_off
  alias: Automatic ambient lights out
  trigger:
  - platform: template
    value_template: '{{ states.sensor.lightlevel_7.state | int > states.input_number.ambient_off_above_lux.state | int }}'
  condition:
    condition: and 
    conditions:
    - condition: state
      entity_id: 'light.livingroom_ceiling'
      state: 'on'
    - condition: state
      entity_id: 'light.livingroom_wall'
      state: 'on'
    - condition: state
      entity_id: 'input_boolean.auto_ambiance_mode'
      state: 'on'
    - condition: template
      value_template: '{{ states.input_select.scene_home.state == "General" }}'
  action:
  - service: light.turn_off
    data:
      entity_id: light.livingroom_ceiling
  - service: light.turn_off
    data:
      entity_id: light.livingroom_wall

- id: stairs_ambioent_off
  alias: Stairs ambient off
  trigger:
  - platform: template
    value_template: '{{ states.input_text.stairs_ambient_off_time.state == states.sensor.time.state }}'
  condition:
    condition: and
    conditions:
    - condition: state
      entity_id: 'input_boolean.ambient_stair_spots'
      state: 'on'
  action:
  - service: light.turn_off
    entity_id: light.stairs

# -----------------------------------------------------------------------
# -----------------------------------------------------------------------
#
# S C E N E N
#


# -----------------------------------------------------------------------
# M O V I E
# -----------------------------------------------------------------------
- id: scene_movie_media
  alias: Scene Movie on Mediaplayer
  trigger:
  - platform: state
    entity_id: media_player.home_theater
    to: 'on'
  - platform: template
    value_template: "{{ state_attr('media_player.home_theater', 'source') == 'DVD' }}"
  condition:
    condition: and
    conditions: 
    - condition: template
      value_template: "{{ state_attr('media_player.home_theater', 'source') == 'DVD' }}"
  action:
  - service: input_select.select_option
    data:
      entity_id: input_select.scene_home
      option: Movie

- id : scene_movie
  alias: Scene Movie
  trigger:
  - platform: state
    entity_id: input_select.scene_home
    to: 'Movie'
  condition:
    condition: and 
    conditions:
    - condition: state
      entity_id: 'group.csalad'
      state: 'home'
  action:
  - service: switch.turn_off
    entity_id: group.kitchen
  - service:  switch.turn_off
    entity_id: group.living_room
  - service:  automation.turn_off
    entity_id: group.automata_lampak
  - service: light.turn_on
    data:
      entity_id: light.livingroom_ceiling
      brightness: 160
      rgb_color: [255,63,0]
  - service: light.turn_on
    data:
      entity_id: light.livingroom_wall
      brightness: 160
      rgb_color: [255,63,0]
  - service: switch.turn_on
    entity_id: switch.ro2_l_r2_1
  - service: switch.turn_on
    entity_id: switch.ro1_l_r2_2
  - service: media_player.turn_on
    entity_id: media_player.home_theater
  - service: media_player.select_source
    data:
      entity_id: media_player.home_theater
      source: 'DVD'
  - service: media_player.volume_set
    data:
      entity_id: media_player.home_theater
      volume_level: 50.0
# -----------------------------------------------------------------------
# -----------------------------------------------------------------------
- id: scene_movie_auto_off
  alias: Scene Movie Off
  trigger:
  - platform: state
    entity_id: media_player.home_theater
    from: 'on'
    to: 'off'
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: input_select.scene_home
        state: Movie
      - condition: time
        after: '22:00:00'
        before: '06:00:00'
  action:
  - service: input_select.select_option
    data:
      entity_id: input_select.scene_home
      option: Sleepy

# -----------------------------------------------------------------------
# S L E E P Y   H O M E
# -----------------------------------------------------------------------
- id : scene_sleepy_home
  alias: Scene Sleepy Home
  trigger:
  - platform: state
    entity_id: input_select.scene_home
    to: Sleepy
  - platform: state
    entity_id: media_player.home_theater
    from: 'on'
    to: 'off'
  - platform: template
    value_template: '{{ states.input_text.sleep_time.state == states.sensor.time.state }}'
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: input_select.scene_home
        state: General
      - condition: time
        after: '22:00:00'
        before: '06:00:00'
      - condition: state
        entity_id: 'group.csalad'
        state: 'home'
  action:
  - service: media_player.turn_off
    entity_id: media_player.home_theater
  - service: switch.turn_off
    entity_id: group.kitchen
  - service:  switch.turn_off
    entity_id: group.living_room
  - service: automation.turn_off
    entity_id: group.automata_lampak
  - service: light.turn_off
    entity_id: light.halofolyoso
  - service: light.turn_on
    data:
      entity_id: light.livingroom_ceiling
      brightness: 60
      rgb_color: [255,255,0]
  - service: light.turn_on
    data:
      entity_id: light.livingroom_wall
      brightness: 60
      rgb_color: [255,255,0]
  - service: timer.start
    entity_id: timer.timer_sleepy_light_off
     
- id: scene_weak_up_family
  alias: Wake Up everybody
  trigger:
  - platform: template
    value_template: '{{ states.input_text.wake_up_time.state == states.sensor.time.state }}'
  - platform: state
    entity_id: input_select.scene_home
    to: WakeUp
  condition:
    condition: and
    conditions:
      - condition: time
        weekday:
          - mon
          - tue
          - wed
          - thu
          - fri
      - condition: state
        entity_id: 'group.csalad'
        state: 'home'
  action:
  - service: input_select.select_option
    data:
      entity_id: input_select.scene_home
      option: WakeUp
  - service: light.turn_on
    data:
      entity_id: light.stairs_1
      brightness: 60
  - service: light.turn_on
    data:
      entity_id: light.stairs_2      
      brightness: 60
  - service: light.turn_on
    data:
      entity_id: light.livingroom_ceiling
      brightness: 100
      rgb_color: [255,255,255]
  - service: light.turn_on
    data:
      entity_id: light.livingroom_wall
      brightness: 100
      rgb_color: [255,255,255]

# -----------------------------------------------------------------------
# G E N E R A L
# -----------------------------------------------------------------------
- id: scene_general
  alias: Scene General
  trigger:
  - platform: template
    value_template: '{{ states.input_text.general_scene_time.state == states.sensor.time.state }}'
  - platform: state
    entity_id: input_select.scene_home
    to: General
  action:
  - service: light.turn_off
    entity_id: light.livingroom_ceiling
  - service: light.turn_off
    entity_id: light.livingroom_wall
  - service: light.turn_off
    entity_id: light.stairs_1
  - service: light.turn_off
    entity_id: light.stairs_2

# -----------------------------------------------------------------------
# -----------------------------------------------------------------------
- id: scene_general_early_activation
  alias: General Scene reggel
  trigger: 
  - platform: sun
    event: 'sunrise'
  condition:
    condition: and
    conditions:
    - condition: template
      value_template: '{{ states.input_select.scene_home.state == "WakeUp" }}'
    - condition: state
      entity_id: 'group.csalad'
      state: 'home'
  action:
  - service: input_select.select_option
    data:
      entity_id: input_select.scene_home
      option: 'General'
  - service: switch.turn_on
    entity_id: switch.ro2_f_r2_3
  - service: switch.turn_on
    entity_id: switch.ro1_f_r2_4

# -----------------------------------------------------------------------  
# S L E E P Y   M O V I N G
# -----------------------------------------------------------------------
- id: sleepy_home_walking_bedroom_floor
  alias: Alvajárók a WC-re
  trigger:
  - platform: state
    entity_id: binary_sensor.tradfri_motion_sensor
    from: 'off'
    to: 'on'  
  - platform: state
    entity_id: binary_sensor.ep1
    from: 'off'
    to: 'on'
  - platform: state
    entity_id: binary_sensor.np1
    from: 'off'
    to: 'on'
  - platform: state
    entity_id: binary_sensor.np2
    from: 'off'
    to: 'on'
  - platform: state
    entity_id: binary_sensor.presence_16
    from: 'off'
    to: 'on'
  condition:
    condition: and
    conditions:
    - condition: template
      value_template: '{{ states.input_select.scene_home.state == "Sleepy" }}'
  action:
  - service: light.turn_on
    data:
      entity_id: light.livingroom_ceiling
      brightness: 60
      rgb_color: [255,255,0]
  - service: light.turn_on
    data:
      entity_id: light.livingroom_wall
      brightness: 60
      rgb_color: [255,255,0]
  - service: timer.start
    entity_id: timer.timer_sleepy_light_off
# -----------------------------------------------------------------------
# -----------------------------------------------------------------------      
- id: sleepy_home_light_off
  alias: Alvajárok lámpa kikapcs
  trigger:
  - platform: event
    event_type: timer.finished
    event_data:
      entity_id: timer.timer_sleepy_light_off
  condition:
  - condition: state
    entity_id: binary_sensor.presence_16
    state: 'off'
  action:
  - service: light.turn_off
    entity_id: light.livingroom_ceiling
  - service: light.turn_off
    entity_id: light.livingroom_wall
  - service: light.turn_off
    entity_id: light.stairs_1
  - service: light.turn_off
    entity_id: light.stairs_2
    
- id: sleepy_home_light_keep_on
  alias: Alvajárok lámpa még mozog
  trigger:
  - platform: event
    event_type: timer.finished
    event_data:
      entity_id: timer.timer_sleepy_light_off
  condition:
  - condition: state
    entity_id: binary_sensor.presence_16
    state: 'on'
  action:
  - service: timer.start
    entity_id: timer.timer_sleepy_light_off
    data_template:
      duration: 00:00:30    

# -----------------------------------------------------------------------
# B U T T O N S
# -----------------------------------------------------------------------
- id: custom_button_push
  alias: Xaomi Button Test
  trigger:
  - platform: event
    event_type: deconz_event
    event_data:
      id: livingroom_switch_01
      event: 1004
  action:
  - service: switch.turn_off
    entity_id: group.downstairs
- id: custom_button_push
  alias: Xaomi Button Test
  trigger:
  - platform: event
    event_type: deconz_event
    event_data:
      id: livingroom_switch_01
      event: 1002
  action:
  - service: input_number.set_value
    data_template:
      entity_id: input_number.light_button_state
      value : |-
        {% if states.switch.el2_r1_6.state  == 'off' and states.switch.nl2_r1_2.state == 'off' -%}
          1
        {% elif states.switch.el2_r1_6.state  == 'on' and states.switch.nl2_r1_2.state == 'off' -%}
          2
        {% elif states.switch.el2_r1_6.state  == 'off' and states.switch.nl2_r1_2.state == 'on' -%}
          3
        {% else -%}
          0
        {% endif %}
  - service: script.turn_on
    entity_id: script.xaomi_light_switch_off
  - service: script.turn_on
    entity_id: script.xaomi_light_switch
# -----------------------------------------------------------------------
# K O N Y H A P U L T   M O Z I   K O Z B E N
# -----------------------------------------------------------------------
- id: konyhapult_movie_light_on
  alias: Konyhapult világítás mozi közben
  initial_state: 'on'
  trigger:
  - entity_id: binary_sensor.presence_5
    platform: state
    to: 'on'
  condition:
  - condition: state
    entity_id: light.kitchen
    state: 'off'
  - condition: template
    value_template: '{{ states.input_select.scene_home.state == "Movie" }}'
  action:
#  - service: rest_command.konyhapult_movie_on
  - service: light.turn_on
    data:
      entity_id: light.kitchen
      brightness: 100
      rgb_color: [100,100,255]
  - service: timer.start
    entity_id: timer.timer_konyhapult_off
    data_template:
      duration: 00:{{ states("input_number.kitchen_light_off_time_movie") | int }}:00    
# -----------------------------------------------------------------------
# -----------------------------------------------------------------------
- id: konyhapult_sleepy_light_on
  alias: Konyhapult világítás este
  initial_state: 'on'
  trigger:
  - entity_id: binary_sensor.presence_5
    platform: state
    to: 'on'
  condition:
  - condition: state
    entity_id: light.kitchen
    state: 'off'
  - condition: template
    value_template: '{{ states.input_select.scene_home.state == "Sleepy" }}'
  action:
#  - service: rest_command.konyhapult_sleepy_on
  - service: light.turn_on
    data:
      entity_id: light.kitchen
      brightness: 100
      rgb_color: [255,255,255]
  - service: timer.start
    entity_id: timer.timer_konyhapult_off
    data_template:
      duration: 00:{{ states("input_number.kitchen_light_off_time_sleepy") | int }}:00    

# -----------------------------------------------------------------------
# K O N Y H A P U L T
# -----------------------------------------------------------------------
- id: konyhapult_light_on
  alias: Konyhapult világítás világosban
  initial_state: 'on'
  trigger:
  - entity_id: binary_sensor.presence_5
    platform: state
    to: 'on'  
  condition:
    condition: and
    conditions:
    - condition: template
      value_template: '{{ states.input_select.scene_home.state == "General" }}'
    - condition: numeric_state
      entity_id: sensor.lightlevel_7
      above: 40
  action:
  - service: light.turn_on
    data:
      entity_id: light.kitchen
      brightness: 255
      rgb_color: [255,255,255]
  - service: timer.start
    entity_id: timer.timer_konyhapult_off
    data_template:
      duration: 00:{{ states("input_number.kitchen_light_off_time_daylight") | int }}:00
- id: konyhapult_light_dark_on
  alias: Konyhapult világítás sötétben
  initial_state: 'on'
  trigger:
  - entity_id: binary_sensor.presence_5
    platform: state
    to: 'on'  
  condition:
    condition: and
    conditions:
    - condition: template
      value_template: '{{ states.input_select.scene_home.state == "General" }}'
    - condition: numeric_state
      entity_id: sensor.lightlevel_7
      below: 40
  action:
  - service: light.turn_on
    data:
      entity_id: light.kitchen
      brightness: 255
      rgb_color: [255,255,255]
  - service: timer.start
    entity_id: timer.timer_konyhapult_off
    data_template:
      duration: 00:{{ states(" input_number.kitchen_light_off_time_dark") | int }}:00
# -----------------------------------------------------------------------
# -----------------------------------------------------------------------    
- id: konyhapult_light_off
  alias: Konyhapult lekapcs
  initial_state: 'on'  
  trigger:
  - platform: event
    event_type: timer.finished
    event_data:
      entity_id: timer.timer_konyhapult_off
  condition:
  - condition: state
    entity_id: light.kitchen
    state: 'on'
  - condition: state
    entity_id: binary_sensor.presence_5
    state: 'off'
  action:
  - service: light.turn_off
    entity_id: light.kitchen
    
- id: konyhapult_light_still_on
  alias: Konyhapult egve marad
  initial_state: 'on'
  trigger:
  - platform: event
    event_type: timer.finished
    event_data:
      entity_id: timer.timer_konyhapult_off
  condition:
  - condition: state
    entity_id: light.kitchen
    state: 'on'
  action:
  - service: timer.start
    entity_id: timer.timer_konyhapult_off
    data_template:
      duration: 00:{{ states("input_number.kitchen_light_off_time_daylight") | int }}:00

# -----------------------------------------------------------------------
# E T K E Z O
# -----------------------------------------------------------------------
- id: ep1_lights_on
  alias: EP1 lights on
  initial_state: 'off'
  trigger:
  - entity_id: binary_sensor.ep1
    from: 'off'
    platform: state
    to: 'on'
  condition:
  - condition: template
    value_template: '{{ (states.sensor.lightlevel_6.state|int) < 39 }}'
  - condition: template
    value_template: '{{ states.input_select.scene_home.state == "General" }}'    
  action:
  - service: timer.start
    entity_id: timer.timer_ep1_lights
  - service: switch.turn_on
    entity_id: switch.el1r1_5
    data:
      entity_id: el1r5
  - service: switch.turn_on
    entity_id: switch.el2r1_6
    data:
      entity_id: el2r6
  - service: switch.turn_on
    entity_id: switch.el3r1_7
    data:
      entity_id: el3r7
# -----------------------------------------------------------------------
# -----------------------------------------------------------------------
- id: ep1_lights_off
  alias: EP1 lights off
  initial_state: 'off'
  trigger:
  - platform: event
    event_type: timer.finished
    event_data:
      entity_id: timer.timer_ep1_lights
  condition:
  - condition: state
    entity_id: binary_sensor.ep1
    state: 'off'
  action:
  - service: switch.turn_off
    entity_id: switch.el1r1_5
  - service: switch.turn_off
    entity_id: switch.el2r1_6
  - service: switch.turn_off
    entity_id: switch.el3r1_7
# -----------------------------------------------------------------------
# N A P P A L I  1
# -----------------------------------------------------------------------
- id: np1_lights_on
  alias: NP1 lights on
  initial_state: 'off'
  trigger:
  - entity_id: binary_sensor.np1
    from: 'off'
    platform: state
    to: 'on'
  condition:
  - condition: numeric_state
    entity_id: sensor.lightlevel_6
    below: 39
  - condition: template
    value_template: '{{ states.input_select.scene_home.state == "General" }}'
  action:
  - service: timer.start
    entity_id: timer.timer_np1_lights
  - service: switch.turn_on
    entity_id: switch.nl1r1_1
    data:
      entity_id: nl1r1
  - service: switch.turn_on
    entity_id: switch.nl2r1_2
    data:
      entity_id: nl2r2
# -----------------------------------------------------------------------
# -----------------------------------------------------------------------      
- id: np1_lights_off
  alias: NP1 lights off
  initial_state: 'off'
  trigger:
  - platform: event
    event_type: timer.finished
    event_data:
      entity_id: timer.timer_np1_lights
  condition:
  - condition: state
    entity_id: binary_sensor.np1
    state: 'off'
  action:
  - service: switch.turn_off
    entity_id: switch.nl1r1_1
  - service: switch.turn_off
    entity_id: switch.nl2r1_2    
# -----------------------------------------------------------------------
# N A P P A L I  2
# -----------------------------------------------------------------------
- id: np2_lights_on
  alias: NP2 lights on
  initial_state: 'off'
  trigger:
  - entity_id: binary_sensor.np2
    from: 'off'
    platform: state
    to: 'on'
  condition:  
  - condition: numeric_state
    entity_id: sensor.lightlevel_6
    below: 39
  - condition: template
    value_template: '{{ states.input_select.scene_home.state == "General" }}'
  action:
  - service: timer.start
    entity_id: timer.timer_np2_lights
  - service: switch.turn_on
    entity_id: switch.nl3r1_3
    data:
      entity_id: nl3r3
  - service: switch.turn_on
    entity_id: switch.nl2r1_2
    data:
      entity_id: nl2r2
# -----------------------------------------------------------------------
# -----------------------------------------------------------------------
- id: np2_lights_off
  alias: NP2 lights off
  initial_state: 'off'
  trigger:
  - platform: event
    event_type: timer.finished
    event_data:
      entity_id: timer.timer_np2_lights
  condition:
  - condition: state
    entity_id: binary_sensor.np2
    state: 'off'
  action:
  - service: switch.turn_off
    entity_id: switch.nl3r1_3
  - service: switch.turn_off
    entity_id: switch.nl2r1_2
# -----------------------------------------------------------------------
# P R E S E N C E   R E L A T E D
# -----------------------------------------------------------------------
- id: noone_at_home
  alias: Üres a ház
  trigger:
  - platform: state
    entity_id: group.csalad
    from: 'home'
    to: 'not_home'
  action:
  - service: switch.turn_off
    entity_id: group.downstairs
  - service: light.turn_off
    entity_id: group.all_lights
# -----------------------------------------------------------------------
# -----------------------------------------------------------------------
- id: valaki_megjott
  alias: Valaki hazajött
  trigger:
  - platform: state
    entity_id: group.csalad
    from: 'not_home'
    to: 'home'
  condition:  
  - condition: numeric_state
    entity_id: sensor.lightlevel_18
    below: 39
  action:
  - service: switch.turn_on
    entity_id: group.downstairs
  - service: timer.start
    entity_id: timer.timer_welcome_home
# -----------------------------------------------------------------------
# -----------------------------------------------------------------------
- id: valaki_megjott_off
  alias: Valaki hazajött kikapcs
  trigger:
  - platform: event
    event_type: timer.finished
    event_data:
      event_id: timer.timer_welcome_home
  action:
  - service: switch.turn_off
    entity_id: group.downstairs
  - service: input_boolean.turn_on
    entity_id: input_boolean.scene_general_on

# -----------------------------------------------------------------------
# H A L O S Z O B A I   F O L Y O S O
# -----------------------------------------------------------------------
- id: halo_folyoso_mozgas
  alias: Háló folyosó
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: 'binary_sensor.tradfri_motion_sensor'
    from: 'off'
    to: 'on'
  condition:
  - condition: numeric_state
    entity_id: sensor.lightlevel_18
    below: 10
  - condition: template
    value_template: '{{ states.input_select.scene_home.state == "General" }}'
  - condition: time
    after: '06:20:00'
    before: '22:00:00'
  action:
  - service: light.turn_on
    data:
      entity_id: light.foyer
      brightness: 255
      kelvin: 2700
  - service: timer.start
    entity_id: timer.timer_halo_folyoso_ki
# -----------------------------------------------------------------------
# -----------------------------------------------------------------------
- id: halo_folyoso_ki
  alias: Háló folyosó kikapcsol
  initial_state: 'on'
  trigger:
  - platform: event
    event_type: timer.finished
    event_data:
      entity_id: timer.timer_halo_folyoso_ki
  action:
  - service: light.turn_off
    entity_id: light.foyer

# -----------------------------------------------------------------------
# H A L O S Z O B A   S Z E L L O Z T E T E S
# -----------------------------------------------------------------------
- id: halo_ablak_nyitva
  alias: Háló ablak
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: 'binary_sensor.openclose_9'
    from: 'off'
    to: 'on'
  action:
  - service: timer.start
    entity_id: timer.timer_halo_ablak_nyitva
    data_template:
      duration: 00:{{ states("input_number.halo_szelloztetesi_ido") | int }}:00
# -----------------------------------------------------------------------
# -----------------------------------------------------------------------
- id: halo_ablak_bezarva
  alias: Halo ablakot bezartak
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: 'binary_sensor.openclose_9'
    from: 'on'
    to: 'off'
  action:
  - service: timer.cancel
    entity_id: timer.timer_halo_ablak_nyitva
  - service: input_number.set_value
    entity_id: input_number.halo_szelloztetesi_ido
    data:
      value: 10
# -----------------------------------------------------------------------
# -----------------------------------------------------------------------
- id: halo_szelloztetes_lejart
  alias: Háló szelloztetés vége
  initial_state: 'on'
  trigger:
  - platform: event
    event_type: timer.finished
    event_data:
      entity_id: timer.timer_halo_ablak_nyitva
  condition:
  - condition: state
    entity_id: input_boolean.summer_heat_mode
    state: 'off'
  action:
  - service: notify.csilla_tamas_phone
    data:
      title: "A B L A K"
      message: "Hálóban be kéne csukni az ablakot!"
      data:
        push:
          sound: "US-EN-Daisy-Master-Bedroom-Window-Open.wav"
          badge: 5 
  - service: timer.start
    entity_id: timer.timer_halo_ablak_nyitva 
    data_template:
      duration: 00:{{ states("input_number.halo_szelloztetesi_ido") | int }}:00
# -----------------------------------------------------------------------
# S Z E L L O Z T E T E S   F U R D O S Z O B A
# -----------------------------------------------------------------------
- id: furdo_kisablak_nyitva
  alias: Fürdö kisablak
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: 'binary_sensor.openclose_15'
    from: 'off'
    to: 'on'
  action:
  - service: timer.start
    entity_id: timer.timer_furdo_ablak_nyitva
    data_template:
      duration: 00:{{ states("input_number.furdo_szelloztetesi_ido") | int }}:00
# -----------------------------------------------------------------------
# -----------------------------------------------------------------------
- id: furdo_kisablak_bezarva
  alias: Furdo kisablakot bezartak
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: 'binary_sensor.openclose_15'
    from: 'on'
    to: 'off'
  action:
  - service: timer.cancel
    entity_id: timer.timer_furdo_ablak_nyitva
  - service: input_number.set_value
    entity_id: input_number.furdo_szelloztetesi_ido
    data:
      value: 10
# -----------------------------------------------------------------------
# -----------------------------------------------------------------------
- id: furdo_szelloztetes_lejart
  alias: Fürdö szelloztetés vége
  initial_state: 'on'
  trigger:
  - platform: event
    event_type: timer.finished
    event_data:
      entity_id: timer.timer_furdo_ablak_nyitva
  condition:
  - condition: state
    entity_id: input_boolean.summer_heat_mode
    state: 'off'      
  action:
  - service: notify.csilla_tamas_phone
    data:
      title: "A B L A K"
      message: "Fürdőszobában be kéne csukni a kicsi ablakot!"
      data:
        push:
          sound: "US-EN-Daisy-Master-Bedroom-Window-Open.wav"
          badge: 5 
  - service: timer.start
    entity_id: timer.timer_furdo_ablak_nyitva  
    data_template:
      duration: 00:{{ states("input_number.furdo_szelloztetesi_ido") | int }}:00
# -----------------------------------------------------------------------
# Nagy ablak a furdoben
# -----------------------------------------------------------------------
- id: furdo_nagyablak_nyitva
  alias: Fürdö nagyablak
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: 'binary_sensor.openclose_11'
    from: 'off'
    to: 'on'
  action:
  - service: timer.start
    entity_id: timer.timer_furdo_nagyablak_nyitva
    data_template:
      duration: 00:{{ states("input_number.furdo_szelloztetesi_ido") | int }}:00
# -----------------------------------------------------------------------
# -----------------------------------------------------------------------
- id: furdo_nagyablak_bezarva
  alias: Furdo nagyablakot bezartak
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: 'binary_sensor.openclose_11'
    from: 'on'
    to: 'off'
  action:
  - service: timer.cancel
    entity_id: timer.timer_furdo_nagyablak_nyitva
  - service: input_number.set_value
    entity_id: input_number.furdo_szelloztetesi_ido
    data:
      value: 10
# -----------------------------------------------------------------------
# -----------------------------------------------------------------------
- id: furdo_nagyszelloztetes_lejart
  alias: Fürdö nagy-szelloztetés vége
  initial_state: 'on'
  trigger:
  - platform: event
    event_type: timer.finished
    event_data:
      entity_id: timer.timer_furdo_nagyablak_nyitva
  condition:
  - condition: state
    entity_id: input_boolean.summer_heat_mode
    state: 'off'
  action:
  - service: notify.csilla_tamas_phone
    data:
      title: "A B L A K"
      message: "Fürdőszobában be kéne csukni a nagy ablakot!"
      data:
        push:
          sound: "US-EN-Daisy-Master-Bedroom-Window-Open.wav"
          badge: 5 
  - service: timer.start
    entity_id: timer.timer_furdo_nagyablak_nyitva  
    data_template:
      duration: 00:{{ states("input_number.furdo_szelloztetesi_ido") | int }}:00
# -----------------------------------------------------------------------
# Notify Tamas when someone came home
# -----------------------------------------------------------------------
- id: somebody_came_home
  alias: valaki hazajott uzenet
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: 'device_tracker.csilla_iphoneja'
    from: 'not_home'
    to: 'home'
  - platform: state
    entity_id: 'device_tracker.csongor_iphoneja'
    from: 'not_home'
    to: 'home'
  - platform: state
    entity_id: 'device_tracker.dalma_iphoneja'
    from: 'not_home'
    to: 'home'
  condition:  
  - condition: state
    entity_id: device_tracker.tamas_iphone
    state: 'not_home'
  action:
  - service: notify.tamas
    data: 
      title: "C S A L Á D"
      message: "Valaki hazaért"
      data:
        push:
          sound: 'US-EN-Morgan-Freeman-Welcome-Home.wav'
          badge: 5
# -----------------------------------------------------------------------
# Summer mode 
# -----------------------------------------------------------------------
- id: summer_heat_mode
  alias: Nyári kánikula mód
  initial_state: 'on'
  trigger:
  - platform: time_pattern
    minutes: "/50"
  condition:
    - condition: numeric_state
      entity_id: sensor.dark_sky_temperature
      above: 24
    - condition: numeric_state
      entity_id: sensor.dark_sky_wind_speed
      below: 10
  action:
  - service: input_boolean.turn_on
    entity_id: input_boolean.summer_heat_mode
# -----------------------------------------------------------------------
# -----------------------------------------------------------------------
- id: summer_heat_mode_off
  alias: Nyári kánikula mód - kikapcs
  initial_state: 'on'
  trigger:
  - platform: time_pattern
    minutes: "/50"
  condition:
    - condition: numeric_state
      entity_id: sensor.dark_sky_daytime_high_temperature_1d
      below: 22
    - condition: numeric_state
      entity_id: sensor.dark_sky_wind_speed
      above: 10
  action:
  - service: input_boolean.turn_off
    entity_id: input_boolean.summer_heat_mode

