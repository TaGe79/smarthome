resources:
  - url: /local/shutter.js
    type: js
  - url: /local/mini-graph-card-bundle.js?v=0.5.0
    type: module
  - url: /local/button-card/button-card.js
    type: module
  - url: /local/custom-lovelace/compact-custom-header/compact-custom-header.js?v=0.0.1
    type: module    
views:
  - title: Main
    path: main
    panel: true
    badges:
      - entity: input_select.scene_home
    cards:
      - type: horizontal-stack
        cards:
        - type: vertical-stack
          cards:
          - type: picture-entity
            entity: input_select.scene_home
            aspect_ratio: 16x9
            state_image: 
              "Movie": http://patvarutca4.duckdns.org:8081/
              "General": http://patvarutca4.duckdns.org:8081/
              "Sleepy": http://patvarutca4.duckdns.org:8081/
              "WakeUp": http://patvarutca4.duckdns.org:8081/
          - type: horizontal-stack
            cards:
            - type: entity-button
              name: Nappali
              entity: switch.nl2_r1_2
              icon: mdi:lightbulb-outline
              icon_height: 30pt
            - type: entity-button
              name: Étkező
              entity: switch.el2_r1_6
              icon: mdi:lightbulb-outline
              icon_height: 30pt
          - type: conditional
            conditions: 
            - entity: media_player.home_theater
              state_not: "off"
            card:
              type: horizontal-stack
              cards:
                - type: "custom:button-card"
                  color_type: blank-card
                - type: "custom:button-card"
                  color_type: blank-card
                - type: "custom:button-card"
                  color_type: card
                  color: rgb(223, 255, 97)
                  icon: mdi:volume-plus
                  tap_action:
                    action: call-service
                    service: media_player.volume_up
                    service_data:
                      entity_id: media_player.home_theater
                - type: "custom:button-card"
                  color_type: card
                  color: rgb(223, 255, 97)
                  icon: mdi:volume-minus
                  tap_action:
                    action: call-service
                    service: media_player.volume_down
                    service_data:
                      entity_id: media_player.home_theater
                - type: "custom:button-card"
                  color_type: blank-card
                - type: "custom:button-card"
                  color_type: blank-card
          - type: conditional
            conditions:
            - entity: media_player.home_theater_2
              state_not: "off"
            card:    
              type: media-control
              entity: media_player.home_theater_2
          - type: weather-forecast
            entity: weather.home
        - type: vertical-stack
          cards:
          - type: horizontal-stack
            cards:
            - type: vertical-stack
              cards:
              - type: "custom:button-card"
                color_type: label-card
                name: Nappali redőny
              - type: horizontal-stack
                cards:
                - type: conditional
                  conditions:
                  - entity: switch.ro1_l_r2_2
                    state: 'off'
                  card:
                    type: "custom:button-card"
                    color_type: card
                    color: rgb(255, 255, 255)
                    icon: mdi:chevron-up
                    tap_action:
                      action: call-service
                      service: switch.toggle
                      service_data:
                        entity_id: switch.ro1_f_r2_4
                - type: conditional
                  conditions:
                  - entity: switch.ro1_l_r2_2
                    state: 'on'
                  card:
                    type: "custom:button-card"
                    color_type: blank-card
                - type: conditional
                  conditions:
                  - entity: switch.ro1_f_r2_4
                    state: 'off'
                  card:
                    type: "custom:button-card"
                    color_type: card
                    color: rgb(255, 255, 255)
                    icon: mdi:chevron-down
                    tap_action:
                      action: call-service
                      service: switch.toggle
                      service_data:
                        entity_id: switch.ro1_l_r2_2
                - type: conditional
                  conditions:
                  - entity: switch.ro1_f_r2_4
                    state: 'on'
                  card:
                    type: "custom:button-card"
                    color_type: blank-card
            - type: vertical-stack
              cards:
              - type: "custom:button-card"
                color_type: label-card
                name: Étkező redőny
              - type: horizontal-stack
                cards:
                - type: conditional
                  conditions:
                  - entity: switch.ro2_l_r2_1
                    state: 'off'
                  card:
                    type: "custom:button-card"
                    color_type: card
                    color: rgb(255, 255, 255)
                    icon: mdi:chevron-up
                    tap_action:
                      action: call-service
                      service: switch.toggle
                      service_data:
                        entity_id: switch.ro2_f_r2_3
                - type: conditional
                  conditions:
                  - entity: switch.ro2_l_r2_1
                    state: 'on'
                  card:
                    type: "custom:button-card"
                    color_type: blank-card
                - type: conditional
                  conditions:
                  - entity: switch.ro2_f_r2_3
                    state: 'off'
                  card:
                    type: "custom:button-card"
                    color_type: card
                    color: rgb(255, 255, 255)
                    icon: mdi:chevron-down
                    tap_action:
                      action: call-service
                      service: switch.toggle
                      service_data:
                        entity_id: switch.ro2_l_r2_1
                - type: conditional
                  conditions:
                  - entity: switch.ro2_l_r2_3
                    state: 'on'
                  card:
                    type: "custom:button-card"
                    color_type: blank-card
          - type: horizontal-stack
            cards:
            - type: glance
              title: Nappali
              entities:
                - entity: sensor.temperature_2
                  name: ""
                - entity: sensor.humidity_3
                  name: ""
            - type: glance
              title: Fürdő
              entities:
                - entity: sensor.temperature_12
                  name: ""
                - entity: sensor.humidity_13
                  name: ""
                - entity: binary_sensor.openclose_11
                  name: ""
                - entity: binary_sensor.openclose_15
                  name: ""
          - type: vertical-stack
            cards:
            - type: horizontal-stack
              cards:
              - type: light
                name: Plafon
                entity: light.livingroom_ceiling
              - type: light
                name: Fal
                entity: light.livingroom_wall
            - type: horizontal-stack
              cards:
              - type: light
                name: Folyosó
                entity: light.foyer
              - type: light
                name: Lépcső
                entity: light.stairs
              - type: custom:button-card
                icon: mdi:lightbulb
                entity: light.kitchen_desk
                name: Konyha
                styles:
                  grid:
                    - position: relative
                    - height: 100%
                  custom_fields:
                    notification:
                      - background-color: >
                          [[[
                            if ( states['binary_sensor.presence_5'].state == 'on' )
                              return "yellow";
                            return "grey";
                          ]]]
                      - border-radius: 50%
                      - position: absolute
                      - left: 65%
                      - top: 7%
                      - height: 25px
                      - width: 25px
                      - font-size: 9px
                      - line-height: 22px
                custom_fields:
                  notification: >
                    [[[ return `<span>${states['binary_sensor.presence_5'].state}</span` ]]]                      
            - type: light
              name: Terasz
              entity: light.terrace
  - title: Mobile
    path: mobile
    panel: false
    badges:
      - entity: device_tracker.csilla_iphone
      - entity: device_tracker.tamasphone
      - entity: device_tracker.dalma_iphone
      - entity: device_tracker.csongor_iphone
    cards:
      - type: vertical-stack
        cards:
        - type: picture-entity
          entity: input_select.scene_home
          aspect_ratio: 16x9
          state_image: 
            "Movie": http://patvarutca4.duckdns.org:8081
            "General": http://patvarutca4.duckdns.org:8081
            "Sleepy": http://patvarutca4.duckdns.org:8081
            "WakeUp": http://patvarutca4.duckdns.org:8081
        - type: horizontal-stack
          cards:
          - type: entity-button
            name: Nappali
            entity: switch.nl2_r1_2
            icon: mdi:lightbulb-outline
            icon_height: 30pt
          - type: entity-button
            name: Étkező
            entity: switch.el2_r1_6
            icon: mdi:lightbulb-outline
            icon_height: 30pt
        - type: conditional
          conditions: 
          - entity: media_player.home_theater
            state_not: "off"
          card:
            type: horizontal-stack
            cards:
              - type: "custom:button-card"
                color_type: blank-card
              - type: "custom:button-card"
                color_type: blank-card
              - type: "custom:button-card"
                color_type: card
                color: rgb(223, 255, 97)
                icon: mdi:volume-plus
                tap_action:
                  action: call-service
                  service: media_player.volume_up
                  service_data:
                    entity_id: media_player.home_theater
              - type: "custom:button-card"
                color_type: card
                color: rgb(223, 255, 97)
                icon: mdi:volume-minus
                tap_action:
                  action: call-service
                  service: media_player.volume_down
                  service_data:
                    entity_id: media_player.home_theater
              - type: "custom:button-card"
                color_type: blank-card
              - type: "custom:button-card"
                color_type: blank-card
#        - type: conditional
#          conditions:
#          - entity: media_player.wohnzimmer
#            state_not: "off"
#          card:    
#            type: media-control
#            entity: media_player.wohnzimmer
        - type: horizontal-stack
          cards:
          - type: vertical-stack
            cards:
            - type: "custom:button-card"
              color_type: label-card
              name: Nappali redőny
            - type: horizontal-stack
              cards:
              - type: conditional
                conditions:
                - entity: switch.ro1_l_r2_2
                  state: 'off'
                card:
                  type: "custom:button-card"
                  color_type: card
                  color: rgb(255, 255, 255)
                  icon: mdi:chevron-up
                  tap_action:
                    action: call-service
                    service: switch.toggle
                    service_data:
                      entity_id: switch.ro1_f_r2_4
              - type: conditional
                conditions:
                - entity: switch.ro1_l_r2_2
                  state: 'on'
                card:
                  type: "custom:button-card"
                  color_type: blank-card
              - type: conditional
                conditions:
                - entity: switch.ro1_f_r2_4
                  state: 'off'
                card:
                  type: "custom:button-card"
                  color_type: card
                  color: rgb(255, 255, 255)
                  icon: mdi:chevron-down
                  tap_action:
                    action: call-service
                    service: switch.toggle
                    service_data:
                      entity_id: switch.ro1_l_r2_2
              - type: conditional
                conditions:
                - entity: switch.ro1_f_r2_4
                  state: 'on'
                card:
                  type: "custom:button-card"
                  color_type: blank-card
          - type: vertical-stack
            cards:
            - type: "custom:button-card"
              color_type: label-card
              name: Étkező redőny
            - type: horizontal-stack
              cards:
              - type: conditional
                conditions:
                - entity: switch.ro2_l_r2_1
                  state: 'off'
                card:
                  type: "custom:button-card"
                  color_type: card
                  color: rgb(255, 255, 255)
                  icon: mdi:chevron-up
                  tap_action:
                    action: call-service
                    service: switch.toggle
                    service_data:
                      entity_id: switch.ro2_f_r2_3
              - type: conditional
                conditions:
                - entity: switch.ro2_l_r2_1
                  state: 'on'
                card:
                  type: "custom:button-card"
                  color_type: blank-card
              - type: conditional
                conditions:
                - entity: switch.ro2_f_r2_3
                  state: 'off'
                card:
                  type: "custom:button-card"
                  color_type: card
                  color: rgb(255, 255, 255)
                  icon: mdi:chevron-down
                  tap_action:
                    action: call-service
                    service: switch.toggle
                    service_data:
                      entity_id: switch.ro2_l_r2_1
              - type: conditional
                conditions:
                - entity: switch.ro2_f_r2_3
                  state: 'on'
                card:
                  type: "custom:button-card"
                  color_type: blank-card
        - type: weather-forecast
          entity: weather.home
        - type: horizontal-stack
          cards:
          - type: glance
            title: Nappali
            entities:
              - entity: sensor.temperature_2
                name: ""
              - entity: sensor.humidity_3
                name: ""
          - type: glance
            title: Fürdő
            entities:
              - entity: sensor.temperature_12
                name: ""
              - entity: sensor.humidity_13
                name: ""
              - entity: binary_sensor.openclose_11
                name: ""
              - entity: binary_sensor.openclose_15
                name: ""
        - type: vertical-stack
          cards:
          - type: horizontal-stack
            cards:
            - type: light
              name: Plafon
              entity: light.livingroom_ceiling
            - type: light
              name: Fal
              entity: light.livingroom_wall
          - type: horizontal-stack
            cards:
            - type: light
              name: Folyosó
              entity: light.foyer
            - type: light
              name: Lépcső
              entity: light.stairs
          - type: horizontal-stack
            cards:
            - type: custom:button-card
              icon: mdi:lightbulb
              entity: light.kitchen_desk
              name: Konyha
              styles:
                grid:
                  - position: relative
                  - height: 100%
                custom_fields:
                  notification:
                    - background-color: >
                        [[[
                          if ( states['binary_sensor.presence_5'].state == 'on' )
                            return "yellow";
                          return "grey";
                        ]]]
                    - border-radius: 50%
                    - position: absolute
                    - left: 65%
                    - top: 7%
                    - height: 25px
                    - width: 25px
                    - font-size: 9px
                    - line-height: 22px
              custom_fields:
                notification: >
                  [[[ return `<span>${states['binary_sensor.presence_5'].state}</span` ]]]
            - type: light
              name: Terasz
              entity: light.terrace
  - title: Lámpák
    path: lights
    cards:
      - type: vertical-stack
        cards:
          - type: "custom:button-card"
            color_type: label-card
            name: Nappali
          - type: horizontal-stack
            cards:
              - type: "custom:button-card"
                entity: switch.nl1_r1_1
                icon: mdi:numeric-1-box-outline
                show_name: false
              - type: "custom:button-card"
                entity: switch.nl2_r1_2
                icon: mdi:numeric-2-box-outline
                show_name: false
              - type: "custom:button-card"
                entity: switch.nl3_r1_3
                icon: mdi:numeric-3-box-outline
                show_name: false
              - type: "custom:button-card"
                entity: group.living_room
                show_name: false
                state:
                  - value: 'on'
                    icon: mdi:eye-off
                  - value: 'off'
                    icon: mdi:eye
          - type: "custom:button-card"
            color_type: label-card
            name: Konyha
          - type: horizontal-stack
            cards:
              - type: "custom:button-card"
                entity: switch.el1_r1_5
                icon: mdi:numeric-1-box-outline
                show_name: false
              - type: "custom:button-card"
                entity: switch.el2_r1_6
                icon: mdi:numeric-2-box-outline
                show_name: false
              - type: "custom:button-card"
                entity: switch.el3_r1_7
                icon: mdi:numeric-3-box-outline
                show_name: false     
              - type: "custom:button-card"
                entity: group.kitchen
                show_name: false
                state:
                  - value: 'on'
                    icon: mdi:eye-off
                  - value: 'off'
                    icon: mdi:eye
          - type: "custom:button-card"
            color_type: label-card
            name: Terasz
          - type: horizontal-stack
            cards:
              - type: "custom:button-card"
                entity: light.terasz_1
                icon: mdi:numeric-1-box-outline
                show_name: false
              - type: "custom:button-card"
                entity: light.terasz_2
                icon: mdi:numeric-2-box-outline
                show_name: false
              - type: "custom:button-card"
                entity: light.terrace
                show_name: false
                state:
                  - value: 'on'
                    icon: mdi:eye-off
                  - value: 'off'
                    icon: mdi:eye
          - type: "custom:button-card"
            color_type: label-card
            name: Lépcső
          - type: horizontal-stack
            cards:
              - type: "custom:button-card"
                entity: light.stairs_1
                icon: mdi:numeric-1-box-outline
                show_name: false
              - type: "custom:button-card"
                entity: light.stairs_2
                icon: mdi:numeric-2-box-outline
                show_name: false
              - type: "custom:button-card"
                entity: light.stairs
                show_name: false
                state:
                  - value: 'on'
                    icon: mdi:eye-off
                  - value: 'off'
                    icon: mdi:eye
      - type: entities
        title: Konyha
        entities:
          - type: light
            entity: light.kitchen
          - type: glance
            entity: binary_sensor.presence_5
            secondary_info: last-changed
            format: relative
      - type: entities
        title: Ambiente
        entities:
          - type: light
            entity: light.livingroom_ceiling
          - type: light
            entity: light.livingroom_wall

  - title: Házimozi
    path: media
    cards:
      - type: media-control
        entity: media_player.home_theater_2
      - type: media-control
        entity: media_player.wohnzimmer

  - title: Státusz
    path: state
    cards:
      - type: entities
        title: Család
        show_header_toggle: false
        entities:
          - device_tracker.dalma_iphone
          - type: section
            label: Csongor
          - type: glance
            entity: device_tracker.csongor_iphoneja
          - type: sensor
            entity: sensor.csongor_iphone_ja_battery_level
            graph: line
            detail: 2
            unit: '%'
            hours_to_show: 24
          - type: section
            label: Csilla
          - type: glance
            entity: device_tracker.csilla_iphoneja
          - type: sensor
            entity: sensor.csilla_iphone_ja_battery_level
            graph: line
            detail: 2
            unit: '%'
            hours_to_show: 24
          - type: section
            label: Tamas
          - type: glance
            entity: device_tracker.tamasphone
          - type: sensor
            entity: sensor.iphone_von_tamas_battery_level
            graph: line
            detail: 2
            unit: '%'
            hours_to_show: 24

      - type: custom:mini-graph-card
        name: Hőmérséklet kint
        entities: 
        - sensor.dark_sky_temperature
        align_state: center
        show:
          extrema: true
          points: true
        graph: line
        unit: C
        detail: 2
        hours_to_show: 24
      
      - type: custom:mini-graph-card
        name: Internet speed      
        entities: 
        - sensor.wireless_broadband_router_kbyte_sec_received
        align_state: center
        show:
          extrema: true
          points: true
        graph: line
        unit: 'kb/sec'
        detail: 2
        hours_to_show: 24
        
      - type: custom:mini-graph-card
        name: Nappali
        entities: 
        - sensor.temperature_2
        align_state: center
        show:
          extrema: true
          points: true
        graph: line
        unit: C
        detail: 2
        hours_to_show: 24
        
      - type: custom:mini-graph-card
        name: Nappali
        entities: 
        - entity: sensor.lightlevel_18
          name: folyosó
        - entity: sensor.lightlevel_7
          name: konyha
        align_state: center
        show:
          extrema: true
          points: true
        graph: line
        unit: lux
        detail: 3
        hours_to_show: 24
        
      - type: custom:mini-graph-card
        name: Fürdőszoba
        entities: 
        - entity: sensor.temperature_12
          name: hőmérséklet
        - entity: sensor.humidity_13
          name: páratartalom
        align_state: center
        show:
          extrema: true
          points: true
        graph: line
        unit: C
        detail: 2
        hours_to_show: 24

      - type: sensor
        entity: sensor.time    
  
      - type: glance
        entities:
          - entity: input_boolean.summer_heat_mode
            name: Nyári kánikula        
            
      - type: custom:button-card
        entity: sensor.load_1m
        icon: 'mdi:raspberry-pi'
        aspect_ratio: 1/1
        name: HassOS
        styles:
          card:
            - background-color: '#000044'
            - border-radius: 10%
            - padding: 10%
            - color: ivory
            - font-size: 10px
            - text-shadow: 0px 0px 5px black
            - text-transform: capitalize
          grid:
            - grid-template-areas: '"i load" "n n" "cpu cpu" "ram ram" "sd sd"'
            - grid-template-columns: 1fr 1fr
            - grid-template-rows: 1fr min-content min-content min-content min-content
          name:
            - font-weight: bold
            - font-size: 13px
            - color: white
            - align-self: middle
            - justify-self: start
            - padding-bottom: 4px
          img_cell:
            - justify-content: start
            - align-items: start
            - margin: none
          icon:
            - color: >
                [[[
                  if (sensor.load_1m < 0.30) return 'lime';
                  if (sensor.load_1m >= 0.30 && sensor.load_1m < 1.0) return 'orange';
                  else return 'red';
                ]]]
            - width: 70%
            - margin-top: -10%
          custom_fields:
            load:
              - align-self: start
              - justify-self: end
            cpu:
              - padding-bottom: 2px
              - align-self: middle
              - justify-self: start
              - --text-color-sensor: '[[[ if (states["sensor.processor_use"].state > 80) return "red"; ]]]'
            ram:
              - padding-bottom: 2px
              - align-self: middle
              - justify-self: start
              - --text-color-sensor: '[[[ if (states["sensor.memory_use_percent"].state > 80) return "red"; ]]]'
            sd:
              - align-self: middle
              - justify-self: start
              - --text-color-sensor: '[[[ if (states["sensor.disk_use_percent"].state > 80) return "red"; ]]]'
        custom_fields:
          load: >
            [[[
              return `<ha-icon
                icon="mdi:desktop-classic"
                style="width: 12px; height: 12px; color: yellow;">
                </ha-icon><span>${sensor.load_1m}</span>`
            ]]]
          cpu: >
            [[[
              return `<ha-icon
                icon="mdi:server"
                style="width: 12px; height: 12px; color: deepskyblue;">
                </ha-icon><span>CPU: <span style="color: var(--text-color-sensor);">${states['sensor.processor_use'].state}%</span></span>`
            ]]]
          ram: >
            [[[
              return `<ha-icon
                icon="mdi:memory"
                style="width: 12px; height: 12px; color: deepskyblue;">
                </ha-icon><span>RAM: <span style="color: var(--text-color-sensor);">${states['sensor.memory_use_percent'].state}%</span></span>`
            ]]]
          sd: >
            [[[
              return `<ha-icon
                icon="mdi:harddisk"
                style="width: 12px; height: 12px; color: deepskyblue;">
                </ha-icon><span>SD: <span style="color: var(--text-color-sensor);">${states['sensor.disk_use_percent'].state}%</span></span>`
            ]]]
  - title: Scenen
    path: scenen
    cards:
     - type: entities       
       title: Scenen
       show_header_toggle: false
       entities:
         - entity: input_select.scene_home

  - title: Beállítások
    path: settings
    cards:
     - type: entities
       title: Szellöztetés
       show_header_toggle: false
       entities:
         - entity: input_number.furdo_szelloztetesi_ido
           name: Fürdő
         - entity: input_number.halo_szelloztetesi_ido
           name: Hálószoba
     - type: entities
       title: Időzítés
       show_header_toggle: false
       entities:
         - type: section
         - entity: input_text.wake_up_time
           name: Ébredezés [hétköznap]
         - entity: input_text.sleep_time
           name: Elalvás
         - type: section
           label: Konyha [perc]
         - entity: input_number.kitchen_light_off_time_movie
           name: mozi közben
         - entity: input_number.kitchen_light_off_time_daylight
           name: nappal
         - entity: input_number.kitchen_light_off_time_dark
           name: sötétben
         - entity: input_number.kitchen_light_off_time_sleepy
           name: élyszaka
     - type: entities
       title: Hangulatvilágítás
       show_header_toggle: false
       entities:
         - type: section
           label: Automatikus kapcsolás [lux]
         - entity: input_number.ambient_on_below_lux
           name: bekapcsol
         - entity: input_number.ambient_off_above_lux
           name: kikapcsol
         - type: section
           label: Lépcső
         - entity: input_boolean.ambient_stair_spots
           name: automata
         - entity: input_number.stair_ambient_brightness
           name: fényerő
         - entity: input_text.stairs_ambient_off_time
           label: lekapcsolás
         - type: section
           label: Nappali
         - entity: input_number.livingroom_ambient_brightness
           name: fényerő
     - type: entities
       title: Egyéb
       show_header_toggle: false
       entities:
         - entity: input_boolean.auto_ambiance_mode
           name: Automatikus hangulatvilágítás
           
